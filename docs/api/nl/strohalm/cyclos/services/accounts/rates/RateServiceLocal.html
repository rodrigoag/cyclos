<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="pt">
<head>
<!-- Generated by javadoc (version 1.7.0_11) on Fri Jan 25 09:33:30 BRST 2013 -->
<title>RateServiceLocal (Cyclos 3 Documentation)</title>
<meta name="date" content="2013-01-25">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="RateServiceLocal (Cyclos 3 Documentation)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceImplMock.html" title="class in nl.strohalm.cyclos.services.accounts.rates"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceSecurityMock.html" title="class in nl.strohalm.cyclos.services.accounts.rates"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html" target="_top">Frames</a></li>
<li><a href="RateServiceLocal.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">nl.strohalm.cyclos.services.accounts.rates</div>
<h2 title="Interface RateServiceLocal" class="title">Interface RateServiceLocal</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html" title="interface in nl.strohalm.cyclos.services.accounts.rates">RateService</a>, <a href="../../../../../../nl/strohalm/cyclos/services/Service.html" title="interface in nl.strohalm.cyclos.services">Service</a></dd>
</dl>
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceImplMock.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RateServiceImplMock</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="strong">RateServiceLocal</span>
extends <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html" title="interface in nl.strohalm.cyclos.services.accounts.rates">RateService</a></pre>
<div class="block">Local interface. It must be used only from other services.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested_classes_inherited_from_class_nl.strohalm.cyclos.services.accounts.rates.RateService">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from interface&nbsp;nl.strohalm.cyclos.services.accounts.rates.<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html" title="interface in nl.strohalm.cyclos.services.accounts.rates">RateService</a></h3>
<code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.RateType.html" title="enum in nl.strohalm.cyclos.services.accounts.rates">RateService.RateType</a></code></li>
</ul>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#applyARateFieldsValidation(nl.strohalm.cyclos.utils.validation.Validator, nl.strohalm.cyclos.services.accounts.rates.ARatedFeeDTO, nl.strohalm.cyclos.entities.accounts.fees.transaction.SimpleTransactionFee.ARateRelation)">applyARateFieldsValidation</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;validator,
                          <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/ARatedFeeDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">ARatedFeeDTO</a>&nbsp;dto,
                          <a href="../../../../../../nl/strohalm/cyclos/entities/accounts/fees/transaction/SimpleTransactionFee.ARateRelation.html" title="enum in nl.strohalm.cyclos.entities.accounts.fees.transaction">SimpleTransactionFee.ARateRelation</a>&nbsp;arateRelation)</code>
<div class="block">does the validation for fields when configuring an A-rated fee.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#applyLoan(nl.strohalm.cyclos.services.transactions.TransferDTO, nl.strohalm.cyclos.services.transactions.GrantLoanDTO)">applyLoan</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/transactions/TransferDTO.html" title="class in nl.strohalm.cyclos.services.transactions">TransferDTO</a>&nbsp;transferDto,
         <a href="../../../../../../nl/strohalm/cyclos/services/transactions/GrantLoanDTO.html" title="class in nl.strohalm.cyclos.services.transactions">GrantLoanDTO</a>&nbsp;params)</code>
<div class="block">applies the rates for a newly created loan</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesToSave.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesToSave</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#applyTransfer(nl.strohalm.cyclos.entities.accounts.transactions.Transfer)">applyTransfer</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;transfer)</code>
<div class="block">applies the needed rate changes which result from the transfer to the account.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#chargeback(nl.strohalm.cyclos.entities.accounts.transactions.Transfer, nl.strohalm.cyclos.entities.accounts.transactions.Transfer)">chargeback</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;original,
          <a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;chargeback)</code>
<div class="block">performs correcting of the rates in a chargeback transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#dateToRate(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">dateToRate</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;ratesDTO)</code>
<div class="block">converts the rate from raw Calendar rates to BigDecimal Rates</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.math.BigDecimal</code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#getARatedFeePercentage(nl.strohalm.cyclos.entities.accounts.fees.transaction.TransactionFee, java.util.Calendar, java.util.Calendar, java.util.Calendar)">getARatedFeePercentage</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/fees/transaction/TransactionFee.html" title="class in nl.strohalm.cyclos.entities.accounts.fees.transaction">TransactionFee</a>&nbsp;fee,
                      java.util.Calendar&nbsp;rawARate,
                      java.util.Calendar&nbsp;rawDRate,
                      java.util.Calendar&nbsp;date)</code>
<div class="block">gets the precentage of the fee with chargeType A_RATED or MIXED_A_D_RATES.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.math.BigDecimal</code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#getDRateConversionResult(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">getDRateConversionResult</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;setOfUnits)</code>
<div class="block">calculates the conversion result according to the D-rate.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#getRateParametersValidator(nl.strohalm.cyclos.utils.validation.Validator, nl.strohalm.cyclos.services.accounts.rates.WhatRate)">getRateParametersValidator</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;validator,
                          <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/WhatRate.html" title="class in nl.strohalm.cyclos.services.accounts.rates">WhatRate</a>&nbsp;whatRate)</code>
<div class="block">gets a validator for the currency's RateParameters.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#getRates(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">getRates</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;dto)</code>
<div class="block">gets all the rates, plus the virtualRatedBalance at the given date.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#getRatesForTransferFrom(nl.strohalm.cyclos.entities.accounts.Account, java.math.BigDecimal, java.util.Calendar)">getRatesForTransferFrom</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/Account.html" title="class in nl.strohalm.cyclos.entities.accounts">Account</a>&nbsp;from,
                       java.math.BigDecimal&nbsp;amount,
                       java.util.Calendar&nbsp;date)</code>
<div class="block">gets all the Rates for a transfer from the from-account.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#isAnyRateEnabled(nl.strohalm.cyclos.entities.accounts.Account, java.util.Calendar)">isAnyRateEnabled</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/Account.html" title="class in nl.strohalm.cyclos.entities.accounts">Account</a>&nbsp;account,
                java.util.Calendar&nbsp;date)</code>
<div class="block">checks if any of the rates is enabled on the given date.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#persist(nl.strohalm.cyclos.services.accounts.rates.RatesToSave)">persist</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesToSave.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesToSave</a>&nbsp;rates)</code>
<div class="block">persists the rates in the argument.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html#rateToDate(nl.strohalm.cyclos.services.accounts.rates.RatesResultDTO)">rateToDate</a></strong>(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;params)</code>
<div class="block">converts the rate from BigDecimals to raw Calendar dates.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_nl.strohalm.cyclos.services.accounts.rates.RateService">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;nl.strohalm.cyclos.services.accounts.rates.<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html" title="interface in nl.strohalm.cyclos.services.accounts.rates">RateService</a></h3>
<code><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#checkPendingRateInitializations(nl.strohalm.cyclos.entities.accounts.Currency)">checkPendingRateInitializations</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#getEnableDate(nl.strohalm.cyclos.entities.accounts.Currency, nl.strohalm.cyclos.services.accounts.rates.RateService.RateType)">getEnableDate</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#getRateConfigGraph(nl.strohalm.cyclos.services.accounts.rates.RatedFeeDTO)">getRateConfigGraph</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#isAnyRateEnabled(nl.strohalm.cyclos.entities.accounts.Currency, java.util.Calendar)">isAnyRateEnabled</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#reinitializeRate(nl.strohalm.cyclos.services.accounts.rates.ReinitializeRatesDTO)">reinitializeRate</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#validate(nl.strohalm.cyclos.services.accounts.rates.RatedFeeDTO, nl.strohalm.cyclos.entities.accounts.fees.transaction.SimpleTransactionFee.ARateRelation)">validate</a>, <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateService.html#validate(nl.strohalm.cyclos.services.accounts.rates.ReinitializeRatesDTO)">validate</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="applyARateFieldsValidation(nl.strohalm.cyclos.utils.validation.Validator, nl.strohalm.cyclos.services.accounts.rates.ARatedFeeDTO, nl.strohalm.cyclos.entities.accounts.fees.transaction.SimpleTransactionFee.ARateRelation)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyARateFieldsValidation</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;applyARateFieldsValidation(<a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;validator,
                                   <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/ARatedFeeDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">ARatedFeeDTO</a>&nbsp;dto,
                                   <a href="../../../../../../nl/strohalm/cyclos/entities/accounts/fees/transaction/SimpleTransactionFee.ARateRelation.html" title="enum in nl.strohalm.cyclos.entities.accounts.fees.transaction">SimpleTransactionFee.ARateRelation</a>&nbsp;arateRelation)</pre>
<div class="block">does the validation for fields when configuring an A-rated fee.</div>
</li>
</ul>
<a name="applyLoan(nl.strohalm.cyclos.services.transactions.TransferDTO, nl.strohalm.cyclos.services.transactions.GrantLoanDTO)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyLoan</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;applyLoan(<a href="../../../../../../nl/strohalm/cyclos/services/transactions/TransferDTO.html" title="class in nl.strohalm.cyclos.services.transactions">TransferDTO</a>&nbsp;transferDto,
                       <a href="../../../../../../nl/strohalm/cyclos/services/transactions/GrantLoanDTO.html" title="class in nl.strohalm.cyclos.services.transactions">GrantLoanDTO</a>&nbsp;params)</pre>
<div class="block">applies the rates for a newly created loan</div>
</li>
</ul>
<a name="applyTransfer(nl.strohalm.cyclos.entities.accounts.transactions.Transfer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyTransfer</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesToSave.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesToSave</a>&nbsp;applyTransfer(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;transfer)</pre>
<div class="block">applies the needed rate changes which result from the transfer to the account. These changes mean:
 <ul>
 <li>rate of the transfer is calculated
 <li>if needed, the from-account's rateBalanceCorrection is saved to the RateSaver object, ready for future persisting.
 <li>this transfer rate is merged with the to-account's rate.
 <li>the result is saved to the resulting RateSaver object, ready for future persisting.
 </ul>
 NO changes are made to the transfer itself, nor to the accounts. <br>
 Note that this method requires that all accounts (both from and to) are locked. The calling method should take care of that.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>transfer</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>RateSaver object with the transfer's rate, and with a que of AccountRates entities to be persisted. These can be persisted as soon as
 the tranfer itself is persisted. If the specific rate is null, it's corresponding field on the result will be null. If no rates enabled, it
 will have all fields set to null.</dd></dl>
</li>
</ul>
<a name="chargeback(nl.strohalm.cyclos.entities.accounts.transactions.Transfer, nl.strohalm.cyclos.entities.accounts.transactions.Transfer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>chargeback</h4>
<pre>void&nbsp;chargeback(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;original,
              <a href="../../../../../../nl/strohalm/cyclos/entities/accounts/transactions/Transfer.html" title="class in nl.strohalm.cyclos.entities.accounts.transactions">Transfer</a>&nbsp;chargeback)</pre>
<div class="block">performs correcting of the rates in a chargeback transaction. This is to be called after all other actions are done, that is: after the
 original transfer is marked as chargedback.
 <p>
 Chargebacks are treated as transactions which are returned/undone. This leads to the following strategy:
 <ul>
 <li>the chargeback transfer is a transfer in the same direction as the original transfer, but with a negated transfer amount. Rates are not
 applied as usual in such a case, but treated in an exceptional way (see next point). Just applying rates with a negated transfer amount would
 lead to deviations in case the accounts have been used in the meantime.
 <li>both involved accounts get their rates recalculated from the date of the original chargedback transfer.
 <li>no deeper levels correction; only correction on the primary involved accounts. This means that any other accounts than the original
 transfer's from and to account will not be updated for any rates that might have been changed due to the chargeback. So there are no side
 effects for other accounts, even if such an other account was involved in a transfer from or to the original from and to accounts, that took
 place between an original transfer and it's chargeback.
 <li>Other transfers are NOT affected by the chargeback. A Transfer is considered an agreement under the then valid circumstances. This means
 that a transfer's rates are fixed from the moment the tranfer is processed, and that these rates are NOT changed as a result of earlier
 chargebacks, even if the account from which the transfer was paid had it's rates changed as a result of a chargeback.
 </ul></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>original</code> - The transfer to be chargedback</dd><dd><code>chargeback</code> - the transfer that was chargedback</dd></dl>
</li>
</ul>
<a name="dateToRate(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dateToRate</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;dateToRate(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;ratesDTO)</pre>
<div class="block">converts the rate from raw Calendar rates to BigDecimal Rates</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>ratesDTO</code> - a RatesDTO which needs to have either emissionDate, expirationDate or both set. It must also have a date set, and in case of
 D-rate, a Currency</dd>
<dt><span class="strong">Returns:</span></dt><dd>sets the calculated BigDecimal rates to a new RatesResultDTO object. If a particular rate in the input is null, the corresponding field
 in the output will be null too.</dd></dl>
</li>
</ul>
<a name="getARatedFeePercentage(nl.strohalm.cyclos.entities.accounts.fees.transaction.TransactionFee, java.util.Calendar, java.util.Calendar, java.util.Calendar)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getARatedFeePercentage</h4>
<pre>java.math.BigDecimal&nbsp;getARatedFeePercentage(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/fees/transaction/TransactionFee.html" title="class in nl.strohalm.cyclos.entities.accounts.fees.transaction">TransactionFee</a>&nbsp;fee,
                                          java.util.Calendar&nbsp;rawARate,
                                          java.util.Calendar&nbsp;rawDRate,
                                          java.util.Calendar&nbsp;date)</pre>
<div class="block">gets the precentage of the fee with chargeType A_RATED or MIXED_A_D_RATES.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>fee</code> - </dd><dd><code>rawARate</code> - a Calendar being the raw A-rate to be used. May NOT be null.</dd><dd><code>rawDRate</code> - a Calendar being the raw D-rate to be used. May be null in case of A_RATED; in that case the param is not used.</dd><dd><code>date</code> - the processdate</dd>
<dt><span class="strong">Returns:</span></dt><dd>the percentage of the fee charge.</dd></dl>
</li>
</ul>
<a name="getDRateConversionResult(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getDRateConversionResult</h4>
<pre>java.math.BigDecimal&nbsp;getDRateConversionResult(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;setOfUnits)</pre>
<div class="block">calculates the conversion result according to the D-rate.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>setOfUnits</code> - a RatesDTO. Needs to have set:
 <ul>
 <li>the currency
 <li>the amount to be converted
 <li>the expiration date.
 <li>the date
 </ul></dd>
<dt><span class="strong">Returns:</span></dt><dd>null if D-rate is not enabled. Otherwise, the sum the member gets from converting the original amount.</dd></dl>
</li>
</ul>
<a name="getRateParametersValidator(nl.strohalm.cyclos.utils.validation.Validator, nl.strohalm.cyclos.services.accounts.rates.WhatRate)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRateParametersValidator</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;getRateParametersValidator(<a href="../../../../../../nl/strohalm/cyclos/utils/validation/Validator.html" title="class in nl.strohalm.cyclos.utils.validation">Validator</a>&nbsp;validator,
                                   <a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/WhatRate.html" title="class in nl.strohalm.cyclos.services.accounts.rates">WhatRate</a>&nbsp;whatRate)</pre>
<div class="block">gets a validator for the currency's RateParameters.</div>
</li>
</ul>
<a name="getRates(nl.strohalm.cyclos.services.accounts.rates.RatesDTO)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRates</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;getRates(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesDTO</a>&nbsp;dto)</pre>
<div class="block">gets all the rates, plus the virtualRatedBalance at the given date. If the date in the param is null, it gets the present rates.
 <ul>
 <li>if no rates are enabled on the requested date, it returns a RatesResultDTO with all rate fields set to null.
 <li>If some rate (A, D, I) is not enabled on the requested date, it's corresponding field on the returned result will be null.
 <li>rates are updated with transfers which happened between the last available AccountRatesEntity and the requested date.
 <li>If a null rate is encountered while the rate is enabled, that rate is initialized. This also counts for rateBalanceCorrection/VRB. An
 exception is the I-rate, as this cannot be initialized. In this case an alert is fired
 <li>If the account is an unlimited type, the virtualRatedBalance is set to zero. See next item for consequences.
 <li>If the virtualRatedBalance is zero, rates are set to their creation value.
 </ul></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>a</code> - RatesDTO with the following set:
 <ul>
 <li>date - may be null, in which case the present rates are retrieved, and the history is not looped
 <li>account
 <li>amount (balance)
 </ul></dd>
<dt><span class="strong">Returns:</span></dt><dd>a RatesResultDTO containing enabled rates and VRB. Rates are included as raw rates and as BigDecimals.</dd></dl>
</li>
</ul>
<a name="getRatesForTransferFrom(nl.strohalm.cyclos.entities.accounts.Account, java.math.BigDecimal, java.util.Calendar)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRatesForTransferFrom</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;getRatesForTransferFrom(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/Account.html" title="class in nl.strohalm.cyclos.entities.accounts">Account</a>&nbsp;from,
                                     java.math.BigDecimal&nbsp;amount,
                                     java.util.Calendar&nbsp;date)</pre>
<div class="block">gets all the Rates for a transfer from the from-account. Does this by checking if the account has sufficient balance. If not, it creates extra
 units by going negative. Created units get a rate as specifically defined for newly created units. Note that the method does NOT check if the
 lower account limit is violated; this is a task to be done by the calling method. It either doesn't set a new ratebalancecorrection on the from
 account if it finds out new units have to be created.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>from</code> - the from Account</dd><dd><code>amount</code> - the amount to be taken from the from account</dd><dd><code>date</code> - the date of the (supposed) transfer; if null, this is now.</dd>
<dt><span class="strong">Returns:</span></dt><dd>a RatesResultDTO containing the raw rates as well as their BigDecimal numerical equivalents to be used for this transfer. If new units
 had to be created because of this account going negative, then the DTO also contains the new value for rateBalanceCorrection. Calling methods
 should check on this, and save this if appropriate. Returns null if the rate is not enabled on the currency.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - in case of payments in past, that is, if transfers exist for this account after or ON the requested date. NOTE
 that the method also raises the exception in case of an already existing, processed transfer with the exact same date/time.</dd></dl>
</li>
</ul>
<a name="isAnyRateEnabled(nl.strohalm.cyclos.entities.accounts.Account, java.util.Calendar)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isAnyRateEnabled</h4>
<pre>boolean&nbsp;isAnyRateEnabled(<a href="../../../../../../nl/strohalm/cyclos/entities/accounts/Account.html" title="class in nl.strohalm.cyclos.entities.accounts">Account</a>&nbsp;account,
                       java.util.Calendar&nbsp;date)</pre>
<div class="block">checks if any of the rates is enabled on the given date.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>account</code> - </dd><dd><code>date</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>true if any rate enabled</dd></dl>
</li>
</ul>
<a name="persist(nl.strohalm.cyclos.services.accounts.rates.RatesToSave)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persist</h4>
<pre>void&nbsp;persist(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesToSave.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesToSave</a>&nbsp;rates)</pre>
<div class="block">persists the rates in the argument.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>rates</code> - </dd></dl>
</li>
</ul>
<a name="rateToDate(nl.strohalm.cyclos.services.accounts.rates.RatesResultDTO)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>rateToDate</h4>
<pre><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;rateToDate(<a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RatesResultDTO.html" title="class in nl.strohalm.cyclos.services.accounts.rates">RatesResultDTO</a>&nbsp;params)</pre>
<div class="block">converts the rate from BigDecimals to raw Calendar dates. As I-rate doesn't have a raw calendar date, i-rate is ignored.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>ratesResultDTO</code> - a RatesResultDTO which needs to have either emissionDate, expirationDate or both set. It also needs to have a date set.</dd>
<dt><span class="strong">Returns:</span></dt><dd>sets the calculated Calendar raw rates to a new RatesResultDTO object. If a particular rate in the input is null, the corresponding
 field in the output will be null too.</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceImplMock.html" title="class in nl.strohalm.cyclos.services.accounts.rates"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../nl/strohalm/cyclos/services/accounts/rates/RateServiceSecurityMock.html" title="class in nl.strohalm.cyclos.services.accounts.rates"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?nl/strohalm/cyclos/services/accounts/rates/RateServiceLocal.html" target="_top">Frames</a></li>
<li><a href="RateServiceLocal.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
